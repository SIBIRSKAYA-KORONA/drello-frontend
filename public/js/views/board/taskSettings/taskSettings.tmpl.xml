<fest:template xmlns:fest="http://fest.mail.ru" context_name="task">
    <div class="window-overlay popup">
        <div class="task">
            <div class="task-title">
                <div class="task-title__text">
                    <fest:value>
                        task.title
                    </fest:value>
                </div>
                <div class="task-title__hr--width-2"/>
            </div>

            <div class="task-settings">
                <div class="container-2cols">
                    <div>
                        <div class="task-settings__label">Участники</div>
                        <div class="container-row">
                            <div class="task-settings-members">
                                <fest:for iterate="task.members" index="i" value="member">
                                    <!--<a href="{member.url}">-->
                                    <img class="task-settings-members__member" src="{member.avatar}"
                                         alt="{member.nickname}"
                                         title="{member.nickname}"/>
                                    <!--</a>-->
                                </fest:for>
                            </div>
                            <img class="task-settings-members__add-button js-addAssign"
                                 src="/img/plus_icon.svg"/>
                        </div>
                    </div>

                    <div>
                        <div class="task-settings__label">Метки</div>
                        <div class="task-label-list">
                            <fest:for iterate="task.labels" index="i" value="label">
                                <div class="task-label-list__label task-label--color--{label.color}">
                                    <fest:value>
                                        label.title
                                    </fest:value>
                                </div>
                            </fest:for>
                            <div class="task-label-list__label task-settings-labels__add-button js-addNewLabel">+</div>
                        </div>
                    </div>
                </div>

                <div class="task-settings__label">Название</div>
                <input class="task-settings__input js-inputTitle" type="text" autocomplete="off">
                    <fest:attributes>
                        <fest:attribute name="value">
                            <fest:value>task.title</fest:value>
                        </fest:attribute>
                    </fest:attributes>
                </input>

                <div class="task-settings__label">
                    Описание
                </div>
                <div contenteditable="" class="task-settings__input js-inputDescription">
                    <fest:value>
                        task.description
                    </fest:value>
                </div>

                <div class="task-settings-controls">
                    <div class="task-settings-controls__button--primary js-saveTask">Сохранить</div>
                    <div class="task-settings-controls__button--secondary js-addNewChecklist">Добавить чеклист</div>
                    <div>
                        <input class="js-attachFile" id="fileInput" type="file"/>
                        <label for="fileInput">
                            <div class="task-settings-controls__button--secondary">Прикрепить файл</div>
                        </label>
                    </div>
                    <div class="task-settings-controls__button--danger js-deleteTask">Удалить задачу</div>
                </div>

                <div class="task-files">
                    <fest:for index="i" iterate="task.files" value="file">
                        <fest:value>file.filename</fest:value>,
                        <fest:value>file.url</fest:value>
                    </fest:for>
                </div>

                <div class="task-checklists">
                    <fest:for iterate="task.checklists" index="i" value="checklist">
                        <div class="checklist" data-checklist-id="{checklist.id}">

                            <div class="checklist-title">
                                <fest:value>checklist.name</fest:value>
                                <fest:if test="checklist.items.length">
                                    <div class="checklist-title-percents">
                                        <fest:value>checklist.progress</fest:value>%
                                    </div>
                                </fest:if>
                            </div>

                            <fest:if test="checklist.items.length">
                                <div class="checklist-progressbar">
                                    <div class="checklist-progressbar-progress"
                                         style="width: {checklist.progress}%; background: {checklist.progressColor} "/>
                                </div>
                            </fest:if>
                            <div class="task-settings-checklist-items">
                                <fest:for iterate="checklist.items" index="j" value="item">
                                    <div class="checklist-item">
                                        <label class="checkbox-container">
                                            <input type="checkbox" class="js-checklistItem" data-item-id="{item.id}">
                                                <fest:attributes>
                                                    <fest:if test="item.done">
                                                        <fest:attribute name="checked"/>
                                                    </fest:if>
                                                </fest:attributes>
                                            </input>
                                            <div class="custom-label">
                                                <fest:value>item.text</fest:value>
                                            </div>
                                            <div class="custom-checkbox"/>
                                        </label>
                                    </div>
                                </fest:for>
                            </div>

                            <div class="checklist-add-item-form js-checklist-add-item-form display-none">
                                <div class="checklist-add-item-form-controls">
                                    <input class="checklist-add-item-form__input js-inputNewItemTitle" type="text"
                                           autocomplete="off"
                                           placehilder="Новый элемент"/>
                                    <div class="checklist-add-item-form-controls__button--secondary js-createChecklistItem">
                                        Добавить
                                    </div>
                                    <div class="checklist-add-item-form-controls__button--danger js-closeChecklistItemForm">
                                        Закрыть
                                    </div>
                                </div>
                            </div>
                            <div class="task-settings-controls js-checklist-controls">
                                <div class="task-settings-controls__button--secondary js-addNewChecklistItem">
                                    Добавить элемент
                                </div>
                                <div class="task-settings-controls__button--danger js-deleteChecklist">
                                    Удалить чеклист
                                </div>
                            </div>
                        </div>
                    </fest:for>
                </div>

                <fest:if test="task.comments.length !== 0">
                    <div class="task-settings__label">
                        Комментарии
                    </div>
                </fest:if>
                <div class="task-settings-comments">
                    <fest:for iterate="task.comments" index="i" value="comment">
                        <div class="task-settings-comment">
                            <div>
                                <!--<a href="{comment.url}">-->
                                <img class="task-settings-members__member" src="{comment.avatar}"/>
                                <!--</a>-->
                            </div>
                            <div class="task-settings-comment-right-column">
                                <div class="container-2cols">
                                    <div class="task-settings-comment__nickname">
                                        <fest:value>comment.nickname</fest:value>
                                    </div>
                                    <div class="task-settings-comment__date">
                                        <fest:value>comment.date</fest:value>
                                    </div>
                                </div>
                                <div class="task-settings-comment__text">
                                    <fest:value>comment.text</fest:value>
                                </div>
                            </div>
                        </div>
                    </fest:for>
                </div>
                <div class="task-settings-add-comment">
                    <div class="task-settings__label">
                        Ваш комментарий
                    </div>
                    <div contenteditable="" class="task-settings__input js-commentText" placeholder="Ваш комментарий"/>
                    <div class="task-settings-add-comment__button--secondary js-saveComment">Добавить</div>
                </div>

            </div>
        </div>
    </div>

</fest:template>
