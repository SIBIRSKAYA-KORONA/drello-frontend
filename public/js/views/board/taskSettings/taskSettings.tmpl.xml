<fest:template xmlns:fest="http://fest.mail.ru" context_name="task">
    <div class="window-overlay popup">
        <div class="task">
            <div class="task-title">
                <div class="task-title__text">
                    <fest:value>
                        task.title
                    </fest:value>
                </div>
                <div class="task-title__hr--width-2"/>
            </div>

            <div class="task-settings">
                <div class="container-2cols">
                    <div>
                        <div class="task-settings__label">Участники</div>
                        <div class="task-settings-members">
                            <fest:for iterate="task.members" index="i" value="member">
                                <a href="{member.url}">
                                    <img class="task-settings-members__member" src="{member.avatar}"
                                         alt="{member.nickname}"
                                         title="{member.nickname}"/>
                                </a>
                            </fest:for>
                            <img class="task-settings-members__add-button js-addNewTaskMember"
                                 src="/img/plus_icon.svg"/>
                        </div>
                    </div>
                    <div>
                        <div class="task-settings__label">Метки</div>
                        <div class="task-label-list">
                            <fest:for iterate="task.labels" index="i" value="label">
                                <div class="task-label-list__label-mini--color-{label.color}">
                                    <fest:value>
                                        label.title
                                    </fest:value>
                                </div>
                            </fest:for>
                            <div class="button default js-addNewLabel">+</div>
                        </div>
                    </div>
                </div>

                <div class="task-settings__label">Название</div>
                <input class="task-settings__input js-inputTitle" type="text" autocomplete="off">
                    <fest:attributes>
                        <fest:attribute name="value">
                            <fest:value>task.title</fest:value>
                        </fest:attribute>
                    </fest:attributes>
                </input>

                <div class="task-settings__label">
                    Описание
                </div>
                <div contenteditable="" class="task-settings__input js-inputDescription">
                    <fest:value>
                        task.description
                    </fest:value>
                </div>

                <div class="task-settings-controls">
                    <div class="task-settings-controls__button--primary js-saveTask">Сохранить</div>
                    <div class="task-settings-controls__button--secondary js-addNewCheckList">Добавить чеклист</div>
                    <div class="task-settings-controls__button--secondary js-attachFile">Прикрепить файл</div>
                    <div class="task-settings-controls__button--danger js-deleteTask">Удалить задачу</div>
                </div>

                <div class="task-checklists">
                    <fest:for iterate="task.checklists" index="i" value="checklist">
                        <div class="checklist" data-checklist-id="{checklist.id}">
                            <div class="task-settings__label">
                                <fest:value>checklist.name</fest:value>
                            </div>
                            <div class="task-settings-checklist-items">
                                <fest:for iterate="checklist.items" index="j" value="item">
                                    <div class="checklist-item" data-item-id="{item.id}">
                                        <input type="checkbox" id="{i}-{j}" name="{i}-{j}">
                                            <fest:attributes>
                                                <fest:if test="item.isDone">
                                                    <fest:attribute name="checked">
                                                    </fest:attribute>
                                                </fest:if>
                                            </fest:attributes>
                                        </input>
                                        <label for="{i}-{j}">
                                            <fest:value>item.text</fest:value>
                                        </label>
                                    </div>
                                </fest:for>
                            </div>
                            <div class="checklist-add-item-form">
                                <!--TODO  add item popup-->
                            </div>
                            <div class="task-settings-controls">
                                <div class="task-settings-controls__button--secondary js-addNewCheckListItem">
                                    Добавить элемент
                                </div>
                                <div class="task-settings-controls__button--danger js-deleteCheckList">
                                    Удалить чеклист
                                </div>
                            </div>
                        </div>
                    </fest:for>
                </div>

                <fest:if test="task.comments.length !== 0">
                    <div class="task-settings__label">
                        Комментарии
                    </div>
                </fest:if>
                <div class="task-settings-comments">
                    <fest:for iterate="task.comments" index="i" value="comment">
                        <div class="task-settings-comment">
                            <div>
                                <a href="{member.url}">
                                    <img class="task-settings-members__member" src="{comment.avatar}"/>
                                </a>
                            </div>
                            <div class="task-settings-comment-right-column">
                                <div class="container-2cols">
                                    <div class="task-settings-comment__nickname">
                                        <fest:value>comment.nickname</fest:value>
                                    </div>
                                    <div class="task-settings-comment__date">
                                        <fest:value>comment.date</fest:value>
                                    </div>
                                </div>
                                <div class="task-settings-comment__text">
                                    <fest:value>comment.text</fest:value>
                                </div>
                            </div>
                        </div>
                    </fest:for>
                </div>
                <div class="task-settings-add-comment">
                    <div class="task-settings__label">
                        Ваш комментарий
                    </div>
                    <div contenteditable="" class="task-settings__input js-commentText" placeholder="Ваш комментарий"/>
                    <div class="task-settings-add-comment__button--secondary js-saveComment">Добавить</div>
                </div>

            </div>
        </div>
    </div>
</fest:template>
